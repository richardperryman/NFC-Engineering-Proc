<html>
<head>
	<script type="text/javascript">
		var key;
		var userId;
		
		if(localStorage.key){
			key = localStorage.key;
		}
		if(localStorage.userId){
			userId = localStorage.userId;
		}
		
		function login(){
			var username = $('#username').val();
			var password = $('#password').val();
			var obj = {username:username,password:password};
			
			$.post({
				url : "http://sbacs.click/login",
				data : JSON.stringify(obj),
				dataType : 'json',
				success : loginSuccess
			});
			
			console.log('Logging in with: ' + username + ':' + password);
		}
		
		function loginSuccess(data){
			console.log('Log in response: ' + data.key.data.toString());
			key = data.key.data;
			userId = data.user;
			if(typeof(Storage) !== undefined){
				localStorage.setItem('key',key);
				localStorage.setItem('userId',userId);
			}
		}
		
		function getRegistrations(){
			if(userId == undefined){
				return;
			}
			// Make request to access/management endpoint
			var query = '?user_id=' + userId;
			$.get({
				url : ("http://sbacs.click/access/management" + query),
				dataType : 'json',
				success : getRegSuccess,
				headers : {'hmac-user':'10outta13'}
			});
		}
		
		function getRegSuccess(data){
			var regs = [];
			for(var i=0;i<data.length;i++){
				regs[i] = data[i]['Reg_Id'];
			}
			console.log(regs.toString());
		}
		
		function setHeaders(request,body){
			request.setRequestHeader('hmac-user','10outta13');
		}
	</script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	
	<title>SBACS Login</title>
</head>
<body>
	
	<div id="login">
		<form>
			Username: 
			<input id="username" type="text"/>
			<br/>
			Password: 
			<input id="password" type="password"/>
			<br/>
			<input type="button" value="Login" onclick="login();"/>
			<input type="button" value="Get Registrations" onclick="getRegistrations()"/>
		</form>
	</div>
</body>
</html>